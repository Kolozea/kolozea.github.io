<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diffe & Anna - 9 Months of Love</title>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js"></script>
    <!-- Pixel font -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #1a1b3e;
            color: #fff;
            overflow-x: hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><circle cx="8" cy="8" r="7" fill="white" stroke="%231a1b3e" stroke-width="1"/></svg>'), auto;
        }
        
        #app {
            width: 100%;
            min-height: 100vh;
        }
        
        /* Snow Container */
        #snow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .snowflake {
            position: absolute;
            background-color: #e0f7ff;
            border-radius: 50%;
            opacity: 0.8;
            filter: drop-shadow(0 0 2px rgba(224, 247, 255, 0.7));
        }
        
        /* Sections */
        .section {
            position: relative;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            z-index: 2;
        }
        
        /* First Section - Love Story */
        #love-story {
            text-align: center;
            padding-top: 80px;
        }
        
        .title {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(135, 206, 235, 0.8);
            color: #87ceeb;
            line-height: 1.4;
        }
        
        .subtitle {
            font-size: clamp(1rem, 3vw, 1.2rem);
            margin-bottom: 40px;
            color: #ffb6c1;
            line-height: 1.6;
        }
        
        .characters-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
            margin-bottom: 50px;
        }
        
        .character {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .character-name {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .pixel-avatar {
            width: 150px;
            height: 150px;
            image-rendering: pixelated;
            border: 4px solid #ffd700;
            border-radius: 10px;
            background-color: #2a2b5e;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .avatar-heart {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            width: 60px;
            height: 60px;
            background-color: #ff6b8b;
        }
        
        .avatar-heart:before, .avatar-heart:after {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #ff6b8b;
        }
        
        .avatar-heart:before {
            top: -30px;
            left: 0;
        }
        
        .avatar-heart:after {
            top: 0;
            left: -30px;
        }
        
        .stats {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 40px;
            max-width: 600px;
            text-align: left;
            background: rgba(42, 43, 94, 0.8);
            padding: 25px;
            border-radius: 15px;
            border: 3px solid #87ceeb;
            box-shadow: 0 0 20px rgba(135, 206, 235, 0.4);
        }
        
        .stat-item {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #e0f7ff;
        }
        
        .stat-item span {
            color: #ffb6c1;
        }
        
        .scroll-hint {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #87ceeb;
            text-align: center;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);}
            40% {transform: translateX(-50%) translateY(-10px);}
            60% {transform: translateX(-50%) translateY(-5px);}
        }
        
        /* Second Section - Game */
        #game-section {
            background-color: rgba(26, 27, 62, 0.9);
        }
        
        .game-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .game-title {
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 20px;
            color: #ffd700;
            text-align: center;
        }
        
        .game-description {
            font-size: 0.9rem;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.6;
            color: #e0f7ff;
            max-width: 500px;
        }
        
        .game-area {
            width: 100%;
            height: 400px;
            background-color: #2a2b5e;
            border: 4px solid #87ceeb;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(135, 206, 235, 0.5);
            margin-bottom: 30px;
        }
        
        /* Collision Debug (Visible only when debugging) */
        .collision-debug {
            position: absolute;
            border: 1px dashed red;
            pointer-events: none;
            opacity: 0;
        }
        
        .show-collision .collision-debug {
            opacity: 0.5;
        }
        
        .game-ui {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .score-container, .time-container {
            background-color: #2a2b5e;
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #ffd700;
            text-align: center;
            min-width: 150px;
        }
        
        .score-title, .time-title {
            font-size: 0.8rem;
            color: #ffb6c1;
            margin-bottom: 5px;
        }
        
        .score-value, .time-value {
            font-size: 1.5rem;
            color: #ffd700;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }
        
        .btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background-color: #ff6b8b;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #d14a68;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #d14a68;
        }
        
        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #d14a68;
        }
        
        .btn-start {
            background-color: #4ecdc4;
            box-shadow: 0 4px 0 #3a9d96;
        }
        
        .btn-start:hover {
            box-shadow: 0 6px 0 #3a9d96;
        }
        
        .btn-start:active {
            box-shadow: 0 2px 0 #3a9d96;
        }
        
        /* Improved Heart Styling */
        .heart {
            position: absolute;
            transform-origin: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .heart-shape {
            width: 100%;
            height: 100%;
            position: relative;
            transform: rotate(45deg);
            background-color: var(--heart-color);
            box-shadow: 0 0 10px var(--heart-glow);
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        .heart-shape:before,
        .heart-shape:after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: var(--heart-color);
        }
        
        .heart-shape:before {
            top: -50%;
            left: 0;
        }
        
        .heart-shape:after {
            top: 0;
            left: -50%;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: rotate(45deg) scale(1); }
            25% { transform: rotate(45deg) scale(1.1); }
            50% { transform: rotate(45deg) scale(1); }
            75% { transform: rotate(45deg) scale(1.05); }
        }
        
        .player {
            position: absolute;
            width: 40px;
            height: 40px;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #87ceeb;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(135, 206, 235, 0.8);
            border: 2px solid #e0f7ff;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .player-heart {
            width: 20px;
            height: 20px;
            position: relative;
            transform: rotate(45deg);
            background-color: #ff6b8b;
        }
        
        .player-heart:before,
        .player-heart:after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #ff6b8b;
        }
        
        .player-heart:before {
            top: -10px;
            left: 0;
        }
        
        .player-heart:after {
            top: 0;
            left: -10px;
        }
        
        .obstacle {
            position: absolute;
            background-color: #ffd700;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        
        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            text-align: center;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            background-color: rgba(42, 43, 94, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #87ceeb;
            z-index: 10;
        }
        
        .heart-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.7rem;
            color: #ff6b8b;
            background-color: rgba(42, 43, 94, 0.8);
            padding: 5px 10px;
            border-radius: 5px;
            border: 2px solid #ff6b8b;
        }
        
        /* Debug toggle button */
        .debug-toggle {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 20;
            font-size: 0.6rem;
            padding: 5px 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: 1px solid white;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .section {
                padding: 15px;
            }
            
            .title {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .characters-container {
                flex-direction: column;
                gap: 30px;
            }
            
            .pixel-avatar {
                width: 120px;
                height: 120px;
            }
            
            .avatar-heart {
                width: 50px;
                height: 50px;
            }
            
            .avatar-heart:before, .avatar-heart:after {
                width: 50px;
                height: 50px;
            }
            
            .avatar-heart:before {
                top: -25px;
            }
            
            .avatar-heart:after {
                left: -25px;
            }
            
            .stats {
                padding: 15px;
            }
            
            .stat-item {
                font-size: 0.7rem;
            }
            
            .game-area {
                height: 300px;
            }
            
            .game-ui {
                flex-direction: column;
                gap: 15px;
                align-items: center;
            }
            
            .score-container, .time-container {
                min-width: 120px;
                padding: 10px;
            }
            
            .btn {
                font-size: 0.7rem;
                padding: 10px 15px;
            }
        }
        
        @media (max-width: 480px) {
            .title {
                font-size: 1.2rem;
            }
            
            .subtitle {
                font-size: 0.8rem;
            }
            
            .character-name {
                font-size: 1.2rem;
            }
            
            .game-area {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Dynamic Snow Background -->
        <div id="snow-container"></div>
        
        <!-- First Section: Love Story -->
        <section class="section" id="love-story">
            <h1 class="title">Diffe & Anna's<br>9 Months of Love</h1>
            <p class="subtitle">9 months together ❤❤❤</p>
            
            <div class="characters-container">
                <div class="character">
                    <div class="character-name">Diffe</div>
                    <div class="pixel-avatar">
                        <img style="width: 100%;height: 100%;" src="Diffe.jpg"></img>
                    </div>
                </div>
                <div class="character">
                    <div class="character-name">Anna</div>
                    <div class="pixel-avatar">
                        <img style="width: 100%;height: 100%;" src="Anna.jpg"></img>
                    </div>
                </div>
            </div>
            
            <!-- <div class="stats">
                <div class="stat-item">• <span>273 days</span> of shared laughter and joy</div>
                <div class="stat-item">• <span>6,552 hours</span> of building memories together</div>
                <div class="stat-item">• <span>3 seasons</span> experienced side by side</div>
                <div class="stat-item">• <span>Countless moments</span> that made our story special</div>
                <div class="stat-item">• <span>Infinite love</span> growing stronger every day</div>
            </div> -->
            
            <div class="scroll-hint">
                Scroll down for a pixel adventure!<br>
                ▼
            </div>
        </section>
        
        <!-- Second Section: Game -->
        <section class="section" id="game-section">
            <div class="game-container">
                <h2 class="game-title">Pixel Heart Collector</h2>
                <p class="game-description">Help Diffe collect hearts for Anna while avoiding obstacles!<br>Move your finger or mouse left/right to control Diffe.</p>
                
                <div class="game-ui">
                    <div class="score-container">
                        <div class="score-title">HEARTS COLLECTED</div>
                        <div class="score-value">{{ score }}</div>
                    </div>
                    <div class="time-container">
                        <div class="time-title">TIME LEFT</div>
                        <div class="time-value">{{ timeLeft }}s</div>
                    </div>
                </div>
                
                <div class="game-area" 
                     @mousemove="movePlayer" 
                     @touchmove="movePlayerTouch" 
                     ref="gameArea"
                     :class="{'show-collision': showCollision}">
                    
                    <!-- Debug toggle -->
                    <!-- <button class="debug-toggle" @click="toggleCollisionDebug">
                        {{ showCollision ? 'HIDE HITBOXES' : 'SHOW HITBOXES' }}
                    </button> -->
                    
                    <!-- Player with heart inside -->
                    <div class="player" :style="{left: playerPosition + 'px'}">
                        <div class="player-heart"></div>
                        <!-- Player collision debug box -->
                        <div class="collision-debug" 
                             :style="{
                                 width: playerHitbox.width + 'px',
                                 height: playerHitbox.height + 'px',
                                 left: playerHitbox.x + 'px',
                                 top: playerHitbox.y + 'px'
                             }"></div>
                    </div>
                    
                    <!-- Improved Hearts -->
                    <div 
                        v-for="heart in hearts" 
                        :key="heart.id"
                        class="heart"
                        :style="{
                            left: heart.x + 'px',
                            top: heart.y + 'px',
                            width: heart.size + 'px',
                            height: heart.size + 'px',
                            '--heart-color': heart.color,
                            '--heart-glow': heart.glowColor
                        }"
                    >
                        <div class="heart-shape"></div>
                        <!-- Heart collision debug box -->
                        <div class="collision-debug" 
                             :style="{
                                 width: heart.hitbox.width + 'px',
                                 height: heart.hitbox.height + 'px',
                                 left: heart.hitbox.x + 'px',
                                 top: heart.hitbox.y + 'px'
                             }"></div>
                    </div>
                    
                    <!-- Obstacles -->
                    <div 
                        v-for="obstacle in obstacles" 
                        :key="obstacle.id"
                        class="obstacle"
                        :style="{
                            left: obstacle.x + 'px',
                            top: obstacle.y + 'px',
                            width: obstacle.width + 'px',
                            height: obstacle.height + 'px'
                        }"
                    >
                        <!-- Obstacle collision debug box -->
                        <div class="collision-debug" 
                             :style="{
                                 width: obstacle.hitbox.width + 'px',
                                 height: obstacle.hitbox.height + 'px',
                                 left: obstacle.hitbox.x + 'px',
                                 top: obstacle.hitbox.y + 'px'
                             }"></div>
                    </div>
                    
                    <!-- Game Messages -->
                    <div v-if="!gameActive && !gameOver" class="message">
                        Ready to collect hearts for Anna?<br><br>
                        <button class="btn btn-start" @click="startGame">START GAME</button>
                    </div>
                    
                    <div v-if="gameOver" class="message">
                        {{ gameMessage }}<br><br>
                        You collected {{ score }} hearts for Anna!<br><br>
                        <button class="btn btn-start" @click="startGame">PLAY AGAIN</button>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn" @click="moveLeft">← LEFT</button>
                    <button class="btn btn-start" @click="startGame" v-if="!gameActive">{{ gameOver ? 'PLAY AGAIN' : 'START' }}</button>
                    <button class="btn" @click="moveRight">RIGHT →</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;
        
        createApp({
            setup() {
                // Snow effect
                const snowflakes = ref([]);
                
                // Game state
                const gameActive = ref(false);
                const gameOver = ref(false);
                const gameMessage = ref('');
                const score = ref(0);
                const timeLeft = ref(60);
                const playerPosition = ref(200);
                const hearts = ref([]);
                const obstacles = ref([]);
                const gameArea = ref(null);
                const showCollision = ref(false);
                
                // Player hitbox
                const playerHitbox = ref({
                    x: 0,
                    y: 0,
                    width: 40,
                    height: 40,
                    radius: 20
                });
                
                // Game variables
                let gameLoop;
                let heartId = 0;
                let obstacleId = 0;
                let gameWidth = 500;
                let gameHeight = 400;
                
                // Heart colors with matching glow
                const heartColors = [
                    { color: '#ff6b8b', glow: 'rgba(255, 107, 139, 0.8)' },
                    { color: '#ff8e9e', glow: 'rgba(255, 142, 158, 0.8)' },
                    { color: '#ff5252', glow: 'rgba(255, 82, 82, 0.8)' },
                    { color: '#ff4081', glow: 'rgba(255, 64, 129, 0.8)' },
                    { color: '#ff77a9', glow: 'rgba(255, 119, 169, 0.8)' },
                    { color: '#ff4d94', glow: 'rgba(255, 77, 148, 0.8)' }
                ];
                
                // Collision detection helper functions
                const checkRectCollision = (rect1, rect2) => {
                    return (
                        rect1.x < rect2.x + rect2.width &&
                        rect1.x + rect1.width > rect2.x &&
                        rect1.y < rect2.y + rect2.height &&
                        rect1.y + rect1.height > rect2.y
                    );
                };
                
                const checkCircleCollision = (circle1, circle2) => {
                    const dx = circle1.x - circle2.x;
                    const dy = circle1.y - circle2.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    return distance < circle1.radius + circle2.radius;
                };
                
                const checkCircleRectCollision = (circle, rect) => {
                    // Find the closest point on the rectangle to the circle
                    const closestX = Math.max(rect.x, Math.min(circle.x, rect.x + rect.width));
                    const closestY = Math.max(rect.y, Math.min(circle.y, rect.y + rect.height));
                    
                    // Calculate the distance between the circle's center and this closest point
                    const distanceX = circle.x - closestX;
                    const distanceY = circle.y - closestY;
                    
                    // If the distance is less than the circle's radius, collision
                    const distanceSquared = (distanceX * distanceX) + (distanceY * distanceY);
                    return distanceSquared < (circle.radius * circle.radius);
                };
                
                // Update player hitbox position
                const updatePlayerHitbox = () => {
                    const playerX = playerPosition.value;
                    const playerY = gameHeight - 60; // 20px from bottom + 40px height
                    
                    playerHitbox.value = {
                        x: playerX,
                        y: playerY,
                        width: 40,
                        height: 40,
                        radius: 20,
                        centerX: playerX + 20,
                        centerY: playerY + 20
                    };
                };
                
                // Initialize snowflakes
                const createSnowflakes = () => {
                    const snowContainer = document.getElementById('snow-container');
                    const flakeCount = window.innerWidth < 768 ? 50 : 100;
                    
                    for (let i = 0; i < flakeCount; i++) {
                        const snowflake = document.createElement('div');
                        snowflake.className = 'snowflake';
                        
                        // Random properties
                        const size = Math.random() * 6 + 2;
                        const startX = Math.random() * window.innerWidth;
                        const startY = Math.random() * -window.innerHeight;
                        const opacity = Math.random() * 0.6 + 0.3;
                        const speed = Math.random() * 2 + 1;
                        
                        snowflake.style.width = `${size}px`;
                        snowflake.style.height = `${size}px`;
                        snowflake.style.left = `${startX}px`;
                        snowflake.style.top = `${startY}px`;
                        snowflake.style.opacity = opacity;
                        
                        snowContainer.appendChild(snowflake);
                        
                        // Animate snowflake
                        animateSnowflake(snowflake, speed);
                    }
                };
                
                // Animate individual snowflake
                const animateSnowflake = (flake, speed) => {
                    let x = parseFloat(flake.style.left);
                    let y = parseFloat(flake.style.top);
                    
                    const moveFlake = () => {
                        y += speed;
                        x += Math.sin(y * 0.01) * 0.5; // Gentle swaying motion
                        
                        // Reset if snowflake goes off screen
                        if (y > window.innerHeight) {
                            y = -10;
                            x = Math.random() * window.innerWidth;
                        }
                        
                        flake.style.left = `${x}px`;
                        flake.style.top = `${y}px`;
                        
                        requestAnimationFrame(moveFlake);
                    };
                    
                    moveFlake();
                };
                
                // Toggle collision debug view
                const toggleCollisionDebug = () => {
                    showCollision.value = !showCollision.value;
                };
                
                // Initialize game
                const initGame = () => {
                    if (gameArea.value) {
                        gameWidth = gameArea.value.clientWidth;
                        gameHeight = gameArea.value.clientHeight;
                    }
                    
                    playerPosition.value = gameWidth / 2 - 20;
                    hearts.value = [];
                    obstacles.value = [];
                    score.value = 0;
                    timeLeft.value = 60;
                    gameOver.value = false;
                    gameActive.value = false;
                    
                    // Clear any existing game loop
                    if (gameLoop) {
                        clearInterval(gameLoop);
                    }
                };
                
                // Start the game
                const startGame = () => {
                    initGame();
                    gameActive.value = true;
                    gameOver.value = false;
                    
                    // Start game loop
                    gameLoop = setInterval(updateGame, 50);
                    
                    // Start countdown
                    const countdown = setInterval(() => {
                        if (gameActive.value) {
                            timeLeft.value--;
                            
                            if (timeLeft.value <= 0) {
                                endGame("Time's up!");
                                clearInterval(countdown);
                            }
                        } else {
                            clearInterval(countdown);
                        }
                    }, 1000);
                    
                    // Start spawning objects
                    spawnHearts();
                    spawnObstacles();
                };
                
                // Spawn hearts with improved shapes
                const spawnHearts = () => {
                    if (!gameActive.value) return;
                    
                    // Spawn a new heart
                    heartId++;
                    const colorSet = heartColors[Math.floor(Math.random() * heartColors.length)];
                    const heartSize = Math.random() * 25 + 25; // 25-50px
                    const heartRadius = heartSize / 2;
                    
                    hearts.value.push({
                        id: heartId,
                        x: Math.random() * (gameWidth - heartSize),
                        y: -heartSize,
                        size: heartSize,
                        color: colorSet.color,
                        glowColor: colorSet.glow,
                        speed: Math.random() * 2 + 1,
                        rotation: Math.random() * 360,
                        hitbox: {
                            x: 0,
                            y: 0,
                            width: heartSize * 0.8, // Smaller hitbox for better feel
                            height: heartSize * 0.8,
                            radius: heartRadius * 0.8
                        }
                    });
                    
                    // Schedule next heart spawn
                    setTimeout(spawnHearts, Math.random() * 800 + 400);
                };
                
                // Spawn obstacles
                const spawnObstacles = () => {
                    if (!gameActive.value) return;
                    
                    // Spawn a new obstacle
                    obstacleId++;
                    const obstacleWidth = Math.random() * 40 + 20;
                    const obstacleHeight = Math.random() * 30 + 15;
                    
                    obstacles.value.push({
                        id: obstacleId,
                        x: Math.random() * (gameWidth - obstacleWidth),
                        y: -obstacleHeight,
                        width: obstacleWidth,
                        height: obstacleHeight,
                        speed: Math.random() * 2 + 1.5,
                        hitbox: {
                            x: 0,
                            y: 0,
                            width: obstacleWidth,
                            height: obstacleHeight
                        }
                    });
                    
                    // Schedule next obstacle spawn
                    setTimeout(spawnObstacles, Math.random() * 1000 + 600);
                };
                
                // Update game state
                const updateGame = () => {
                    if (!gameActive.value) return;
                    
                    // Update player hitbox
                    updatePlayerHitbox();
                    
                    // Update hearts
                    hearts.value.forEach((heart, index) => {
                        heart.y += heart.speed;
                        
                        // Update heart hitbox position
                        const heartRadius = heart.hitbox.radius;
                        heart.hitbox.x = heart.x + (heart.size - heart.hitbox.width) / 2;
                        heart.hitbox.y = heart.y + (heart.size - heart.hitbox.height) / 2;
                        heart.hitbox.centerX = heart.x + heart.size / 2;
                        heart.hitbox.centerY = heart.y + heart.size / 2;
                        
                        // Check collision with player using circle collision
                        const heartCircle = {
                            x: heart.hitbox.centerX,
                            y: heart.hitbox.centerY,
                            radius: heart.hitbox.radius
                        };
                        
                        const playerCircle = {
                            x: playerHitbox.value.centerX,
                            y: playerHitbox.value.centerY,
                            radius: playerHitbox.value.radius
                        };
                        
                        if (checkCircleCollision(heartCircle, playerCircle)) {
                            // Collect heart
                            hearts.value.splice(index, 1);
                            score.value++;
                            
                            // Create collection effect
                            createCollectionEffect(heart.hitbox.centerX, heart.hitbox.centerY, heart.color);
                        }
                        
                        // Remove if off screen
                        if (heart.y > gameHeight) {
                            hearts.value.splice(index, 1);
                        }
                    });
                    
                    // Update obstacles
                    obstacles.value.forEach((obstacle, index) => {
                        obstacle.y += obstacle.speed;
                        
                        // Update obstacle hitbox position
                        obstacle.hitbox.x = obstacle.x;
                        obstacle.hitbox.y = obstacle.y;
                        
                        // Check collision with player using circle-rectangle collision
                        const playerCircle = {
                            x: playerHitbox.value.centerX,
                            y: playerHitbox.value.centerY,
                            radius: playerHitbox.value.radius * 0.8 // Slightly smaller for better feel
                        };
                        
                        if (checkCircleRectCollision(playerCircle, obstacle.hitbox)) {
                            // Game over on collision
                            endGame("Oops! You hit an obstacle!");
                        }
                        
                        // Remove if off screen
                        if (obstacle.y > gameHeight) {
                            obstacles.value.splice(index, 1);
                        }
                    });
                };
                
                // Create collection effect when heart is collected
                const createCollectionEffect = (x, y, color) => {
                    if (!gameArea.value) return;
                    
                    // Create floating "+1" text
                    const plusOne = document.createElement('div');
                    plusOne.textContent = '+1';
                    plusOne.style.position = 'absolute';
                    plusOne.style.left = `${x}px`;
                    plusOne.style.top = `${y}px`;
                    plusOne.style.color = color;
                    plusOne.style.fontFamily = "'Press Start 2P', cursive";
                    plusOne.style.fontSize = '0.8rem';
                    plusOne.style.zIndex = '5';
                    plusOne.style.textShadow = '0 0 5px rgba(255,255,255,0.8)';
                    plusOne.style.transform = 'translate(-50%, -50%)';
                    
                    gameArea.value.appendChild(plusOne);
                    
                    // Create heart burst particles
                    createHeartBurst(x, y, color);
                    
                    // Animate and remove
                    gsap.to(plusOne, {
                        y: y - 60,
                        opacity: 0,
                        duration: 1,
                        ease: "power2.out",
                        onComplete: () => {
                            if (gameArea.value && gameArea.value.contains(plusOne)) {
                                gameArea.value.removeChild(plusOne);
                            }
                        }
                    });
                };
                
                // Create heart burst particles effect
                const createHeartBurst = (x, y, color) => {
                    if (!gameArea.value) return;
                    
                    const particleCount = 8;
                    
                    for (let i = 0; i < particleCount; i++) {
                        const particle = document.createElement('div');
                        particle.style.position = 'absolute';
                        particle.style.left = `${x}px`;
                        particle.style.top = `${y}px`;
                        particle.style.width = '6px';
                        particle.style.height = '6px';
                        particle.style.backgroundColor = color;
                        particle.style.borderRadius = '50%';
                        particle.style.zIndex = '4';
                        particle.style.transform = 'translate(-50%, -50%)';
                        
                        gameArea.value.appendChild(particle);
                        
                        // Random direction
                        const angle = (i / particleCount) * Math.PI * 2;
                        const distance = Math.random() * 40 + 20;
                        
                        gsap.to(particle, {
                            x: Math.cos(angle) * distance,
                            y: Math.sin(angle) * distance,
                            opacity: 0,
                            scale: 0,
                            duration: 0.8,
                            ease: "power2.out",
                            onComplete: () => {
                                if (gameArea.value && gameArea.value.contains(particle)) {
                                    gameArea.value.removeChild(particle);
                                }
                            }
                        });
                    }
                };
                
                // End the game
                const endGame = (message) => {
                    gameActive.value = false;
                    gameOver.value = true;
                    gameMessage.value = message;
                    
                    // Clear game loop
                    if (gameLoop) {
                        clearInterval(gameLoop);
                    }
                    
                    // Create celebration effect if score is good
                    if (score.value >= 5) {
                        createCelebrationEffect();
                    }
                };
                
                // Create celebration effect for good score
                const createCelebrationEffect = () => {
                    if (!gameArea.value) return;
                    
                    // Create multiple hearts floating up
                    for (let i = 0; i < 15; i++) {
                        setTimeout(() => {
                            const heart = document.createElement('div');
                            heart.style.position = 'absolute';
                            heart.style.left = `${Math.random() * gameWidth}px`;
                            heart.style.top = `${gameHeight + 20}px`;
                            heart.style.width = '20px';
                            heart.style.height = '20px';
                            heart.style.zIndex = '3';
                            
                            // Create heart shape
                            const heartShape = document.createElement('div');
                            heartShape.style.width = '100%';
                            heartShape.style.height = '100%';
                            heartShape.style.position = 'relative';
                            heartShape.style.transform = 'rotate(45deg)';
                            heartShape.style.backgroundColor = heartColors[i % heartColors.length].color;
                            
                            const before = document.createElement('div');
                            const after = document.createElement('div');
                            before.style.position = after.style.position = 'absolute';
                            before.style.width = after.style.width = '100%';
                            before.style.height = after.style.height = '100%';
                            before.style.borderRadius = after.style.borderRadius = '50%';
                            before.style.backgroundColor = after.style.backgroundColor = heartColors[i % heartColors.length].color;
                            before.style.top = '-50%';
                            before.style.left = '0';
                            after.style.top = '0';
                            after.style.left = '-50%';
                            
                            heartShape.appendChild(before);
                            heartShape.appendChild(after);
                            heart.appendChild(heartShape);
                            gameArea.value.appendChild(heart);
                            
                            // Animate heart floating up
                            gsap.to(heart, {
                                y: -200,
                                rotation: 360,
                                opacity: 0,
                                duration: 2,
                                ease: "power2.out",
                                onComplete: () => {
                                    if (gameArea.value && gameArea.value.contains(heart)) {
                                        gameArea.value.removeChild(heart);
                                    }
                                }
                            });
                        }, i * 100);
                    }
                };
                
                // Move player with mouse/touch
                const movePlayer = (event) => {
                    if (!gameActive.value) return;
                    
                    const rect = gameArea.value.getBoundingClientRect();
                    const x = event.clientX - rect.left;
                    
                    // Keep player within bounds
                    playerPosition.value = Math.max(0, Math.min(x - 20, gameWidth - 40));
                };
                
                const movePlayerTouch = (event) => {
                    if (!gameActive.value) return;
                    
                    event.preventDefault();
                    const rect = gameArea.value.getBoundingClientRect();
                    const touch = event.touches[0];
                    const x = touch.clientX - rect.left;
                    
                    // Keep player within bounds
                    playerPosition.value = Math.max(0, Math.min(x - 20, gameWidth - 40));
                };
                
                // Button controls for mobile
                const moveLeft = () => {
                    if (!gameActive.value) return;
                    playerPosition.value = Math.max(0, playerPosition.value - 30);
                };
                
                const moveRight = () => {
                    if (!gameActive.value) return;
                    playerPosition.value = Math.min(gameWidth - 40, playerPosition.value + 30);
                };
                
                // Initialize on mount
                onMounted(() => {
                    createSnowflakes();
                    initGame();
                    
                    // Initialize GSAP ScrollTrigger for smooth transitions
                    gsap.registerPlugin(ScrollTrigger);
                    
                    // Smooth scroll between sections
                    gsap.to("#love-story", {
                        scrollTrigger: {
                            trigger: "#love-story",
                            start: "top top",
                            end: "bottom top",
                            scrub: true,
                            onLeave: () => {
                                gsap.to("#love-story .title, #love-story .subtitle, #love-story .characters-container, #love-story .stats", {
                                    opacity: 0.3,
                                    duration: 0.5
                                });
                            },
                            onEnterBack: () => {
                                gsap.to("#love-story .title, #love-story .subtitle, #love-story .characters-container, #love-story .stats", {
                                    opacity: 1,
                                    duration: 0.5
                                });
                            }
                        }
                    });
                });
                
                return {
                    snowflakes,
                    gameActive,
                    gameOver,
                    gameMessage,
                    score,
                    timeLeft,
                    playerPosition,
                    playerHitbox,
                    hearts,
                    obstacles,
                    gameArea,
                    showCollision,
                    createSnowflakes,
                    startGame,
                    movePlayer,
                    movePlayerTouch,
                    moveLeft,
                    moveRight,
                    initGame,
                    toggleCollisionDebug
                };
            }
        }).mount('#app');
    </script>
</body>
</html>